<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>H·ªá Th·ªëng Qu·∫£n L√Ω Kho Xe</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }
        
        header {
            background: white;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        
        h1 {
            color: #667eea;
            text-align: center;
        }
        
        .menu {
            display: flex;
            gap: 10px;
            background: white;
            padding: 10px;
            border-radius: 10px;
            margin-bottom: 20px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            flex-wrap: wrap;
        }
        
        .menu-btn {
            flex: 1;
            min-width: 200px;
            padding: 15px 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: transform 0.2s, box-shadow 0.2s;
        }
        
        .menu-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(102, 126, 234, 0.4);
        }
        
        .menu-btn.active {
            background: linear-gradient(135deg, #764ba2 0%, #667eea 100%);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.5);
        }
        
        .content {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        
        .section {
            display: none;
        }
        
        .section.active {
            display: block;
        }
        
        .form-section {
            margin-bottom: 30px;
            padding: 20px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            background: #f9f9f9;
        }
        
        .form-section h3 {
            color: #667eea;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid #667eea;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        label {
            display: block;
            margin-bottom: 5px;
            color: #333;
            font-weight: 600;
        }
        
        input, select, textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 14px;
        }
        
        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }
        
        .form-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
        }
        
        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.3s;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
        }
        
        .btn-success {
            background: #28a745;
            color: white;
        }
        
        .btn-success:hover {
            background: #218838;
        }
        
        .btn-secondary {
            background: #6c757d;
            color: white;
        }
        
        .btn-actions {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }
        
        .alert {
            padding: 15px;
            margin-bottom: 15px;
            border-radius: 5px;
            display: none;
        }
        
        .alert.show {
            display: block;
        }
        
        .alert-error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        
        .alert-success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .alert-warning {
            background: #fff3cd;
            color: #856404;
            border: 1px solid #ffeaa7;
        }
        
        .file-upload {
            border: 2px dashed #667eea;
            padding: 20px;
            text-align: center;
            border-radius: 5px;
            cursor: pointer;
            transition: background 0.3s;
        }
        
        .file-upload:hover {
            background: #f0f4ff;
        }
        
        .file-list {
            margin-top: 15px;
        }
        
        .file-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            background: white;
            border-radius: 5px;
            margin-bottom: 5px;
        }
        
        .status-badge {
            display: inline-block;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
        }
        
        .status-draft {
            background: #ffc107;
            color: #000;
        }
        
        .status-pending {
            background: #17a2b8;
            color: white;
        }
        
        .status-complete {
            background: #28a745;
            color: white;
        }
        
        .vehicle-list {
            margin-top: 20px;
        }
        
        .vehicle-item {
            background: white;
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 10px;
            border-left: 4px solid #667eea;
        }
        
        .coming-soon {
            text-align: center;
            padding: 60px 20px;
            color: #666;
        }
        
        .coming-soon h2 {
            font-size: 32px;
            margin-bottom: 10px;
            color: #667eea;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>üöó H·ªá Th·ªëng Qu·∫£n L√Ω Kho Xe</h1>
        </header>
        
        <div class="menu">
            <button class="menu-btn active" onclick="showSection('nhap-xe')">üì• Nh·∫≠p xe v√†o kho</button>
            <button class="menu-btn" onclick="showSection('xuat-xe')">üì§ Xu·∫•t xe kh·ªèi kho</button>
            <button class="menu-btn" onclick="showSection('kiem-ke')">üìä Ki·ªÉm k√™ v√† theo d√µi t·ªìn kho</button>
            <button class="menu-btn" onclick="showSection('bao-cao')">üìà B√°o c√°o v√† d·ª± b√°o kho</button>
        </div>
        
        <div class="content">
            <!-- NH·∫¨P XE V√ÄO KHO -->
            <div id="nhap-xe" class="section active">
                <h2>üì• Nh·∫≠p Xe V√†o Kho</h2>
                
                <div class="alert alert-warning" id="documentAlert">
                    ‚ö†Ô∏è Vui l√≤ng ƒë√≠nh k√®m ƒë·∫ßy ƒë·ªß ch·ª©ng t·ª´ tr∆∞·ªõc khi g·ª≠i duy·ªát!
                </div>
                
                <div class="alert alert-error" id="errorAlert"></div>
                <div class="alert alert-success" id="successAlert"></div>
                
                <!-- B∆∞·ªõc 1: T·∫°o phi·∫øu nh·∫≠p -->
                <div class="form-section">
                    <h3>1. T·∫°o Phi·∫øu Nh·∫≠p Xe M·ªõi</h3>
                    <div class="form-row">
                        <div class="form-group">
                            <label>Ch·ªçn Kho *</label>
                            <select id="warehouse" required>
                                <option value="">-- Ch·ªçn kho --</option>
                                <option value="kho-hcm">Kho TP.HCM</option>
                                <option value="kho-hn">Kho H√† N·ªôi</option>
                                <option value="kho-dn">Kho ƒê√† N·∫µng</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Nh√† Cung C·∫•p/ƒê∆°n V·ªã Giao *</label>
                            <input type="text" id="supplier" placeholder="Nh·∫≠p t√™n nh√† cung c·∫•p" required>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label>S·ªë Phi·∫øu *</label>
                            <input type="text" id="receiptNumber" placeholder="V√≠ d·ª•: PN-2025-001" required>
                        </div>
                        <div class="form-group">
                            <label>Ng√†y Nh·∫≠p *</label>
                            <input type="date" id="receiptDate" required>
                        </div>
                    </div>
                    <div class="form-group">
                        <label>Tr·∫°ng Th√°i Phi·∫øu</label>
                        <select id="receiptStatus">
                            <option value="draft">Nh√°p</option>
                            <option value="pending">Ch∆∞a x√°c nh·∫≠n</option>
                        </select>
                        <span class="status-badge status-draft" id="statusBadge">Nh√°p</span>
                    </div>
                </div>
                
                <!-- B∆∞·ªõc 2: Nh·∫≠p th√¥ng tin xe -->
                <div class="form-section">
                    <h3>2. Nh·∫≠p Th√¥ng Tin Chi Ti·∫øt Xe</h3>
                    <div class="form-row">
                        <div class="form-group">
                            <label>H√£ng Xe *</label>
                            <select id="brand" required>
                                <option value="">-- Ch·ªçn h√£ng --</option>
                                <option value="toyota">Toyota</option>
                                <option value="honda">Honda</option>
                                <option value="mazda">Mazda</option>
                                <option value="hyundai">Hyundai</option>
                                <option value="kia">KIA</option>
                                <option value="ford">Ford</option>
                                <option value="vinfast">VinFast</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>D√≤ng Xe *</label>
                            <input type="text" id="model" placeholder="V√≠ d·ª•: Vios, City, CX-5" required>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label>M√†u S·∫Øc *</label>
                            <input type="text" id="color" placeholder="V√≠ d·ª•: Tr·∫Øng ng·ªçc trai" required>
                        </div>
                        <div class="form-group">
                            <label>Phi√™n B·∫£n *</label>
                            <input type="text" id="version" placeholder="V√≠ d·ª•: 1.5G CVT" required>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label>S·ªë VIN (17 k√Ω t·ª±) *</label>
                            <input type="text" id="vin" placeholder="V√≠ d·ª•: JTNK4RBE1A3123456" maxlength="17" required>
                            <small style="color: #666;">VIN ph·∫£i c√≥ ƒë√∫ng 17 k√Ω t·ª±</small>
                        </div>
                        <div class="form-group">
                            <label>S·ªë M√°y *</label>
                            <input type="text" id="engineNumber" placeholder="Nh·∫≠p s·ªë m√°y" required>
                        </div>
                    </div>
                    <div class="form-group">
                        <label>Bi·ªÉn S·ªë</label>
                        <input type="text" id="plateNumber" placeholder="V√≠ d·ª•: 51A-12345">
                    </div>
                    
                    <h4 style="margin-top: 20px; color: #667eea;">Chi Ph√≠ Li√™n Quan</h4>
                    <div class="form-row">
                        <div class="form-group">
                            <label>Gi√° Mua (VNƒê) *</label>
                            <input type="number" id="purchasePrice" placeholder="0" required>
                        </div>
                        <div class="form-group">
                            <label>Thu·∫ø (VNƒê)</label>
                            <input type="number" id="tax" placeholder="0">
                        </div>
                        <div class="form-group">
                            <label>Ph√≠ V·∫≠n Chuy·ªÉn (VNƒê)</label>
                            <input type="number" id="shippingFee" placeholder="0">
                        </div>
                    </div>
                    <div class="form-group">
                        <label>V·ªã Tr√≠ Kho L∆∞u</label>
                        <input type="text" id="storageLocation" placeholder="V√≠ d·ª•: Khu A - D√£y 1 - V·ªã tr√≠ 15">
                    </div>
                    
                    <button class="btn btn-primary" onclick="addVehicle()">‚ûï Th√™m Xe V√†o Phi·∫øu</button>
                </div>
                
                <!-- Danh s√°ch xe ƒë√£ th√™m -->
                <div id="vehicleListSection" style="display: none;">
                    <h3>Danh S√°ch Xe ƒê√£ Th√™m</h3>
                    <div class="vehicle-list" id="vehicleList"></div>
                </div>
                
                <!-- B∆∞·ªõc 3: ƒê√≠nh k√®m ch·ª©ng t·ª´ -->
                <div class="form-section">
                    <h3>3. ƒê√≠nh K√®m Ch·ª©ng T·ª´ Ngu·ªìn G·ªëc</h3>
                    <p style="margin-bottom: 15px; color: #666;">
                        <strong>Ch·ª©ng t·ª´ b·∫Øt bu·ªôc:</strong> H·ª£p ƒë·ªìng/H√≥a ƒë∆°n mua xe, Bi√™n b·∫£n giao nh·∫≠n, Gi·∫•y t·ªù li√™n quan (PDF/JPG)
                    </p>
                    
                    <div class="file-upload" onclick="document.getElementById('fileInput').click()">
                        <p>üìé Nh·∫•p ƒë·ªÉ t·∫£i l√™n ch·ª©ng t·ª´</p>
                        <small>H·ªó tr·ª£: PDF, JPG, PNG (T·ªëi ƒëa 5MB/file)</small>
                    </div>
                    <input type="file" id="fileInput" style="display: none;" accept=".pdf,.jpg,.jpeg,.png" multiple onchange="handleFileUpload(event)">
                    
                    <div class="file-list" id="fileList"></div>
                    
                    <div style="margin-top: 15px;">
                        <strong>Tr·∫°ng th√°i ch·ª©ng t·ª´: </strong>
                        <span class="status-badge status-draft" id="documentStatus">Ch∆∞a ƒë·∫ßy ƒë·ªß</span>
                    </div>
                </div>
                
                <!-- N√∫t h√†nh ƒë·ªông -->
                <div class="btn-actions">
                    <button class="btn btn-primary" onclick="saveDraft()">üíæ L∆∞u Nh√°p</button>
                    <button class="btn btn-success" onclick="submitForApproval()" id="submitBtn" disabled>‚úì G·ª≠i Duy·ªát</button>
                    <button class="btn btn-secondary" onclick="resetForm()">‚Üª L√†m M·ªõi</button>
                </div>
            </div>
            
            <!-- XU·∫§T XE KH·ªéI KHO -->
            <div id="xuat-xe" class="section">
                <h2>üì§ Xu·∫•t Xe Kh·ªèi Kho</h2>
                
                <div class="alert alert-warning" id="exportDocumentAlert">
                    ‚ö†Ô∏è Vui l√≤ng ƒë√≠nh k√®m ƒë·∫ßy ƒë·ªß ch·ª©ng t·ª´ tr∆∞·ªõc khi g·ª≠i duy·ªát!
                </div>
                
                <div class="alert alert-error" id="exportErrorAlert"></div>
                <div class="alert alert-success" id="exportSuccessAlert"></div>
                
                <!-- B∆∞·ªõc 1: T·∫°o phi·∫øu xu·∫•t -->
                <div class="form-section">
                    <h3>1. T·∫°o Phi·∫øu Xu·∫•t Xe M·ªõi</h3>
                    <div class="form-row">
                        <div class="form-group">
                            <label>Lo·∫°i Xu·∫•t *</label>
                            <select id="exportType" required>
                                <option value="">-- Ch·ªçn lo·∫°i xu·∫•t --</option>
                                <option value="sale">B√°n h√†ng</option>
                                <option value="transfer">Chuy·ªÉn chi nh√°nh</option>
                                <option value="warranty">B·∫£o h√†nh</option>
                                <option value="other">Kh√°c</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Ng√†y Xu·∫•t *</label>
                            <input type="date" id="exportDate" required>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label>S·ªë Phi·∫øu Xu·∫•t *</label>
                            <input type="text" id="exportNumber" placeholder="V√≠ d·ª•: PX-2025-001" required>
                        </div>
                        <div class="form-group">
                            <label>Ng∆∞·ªùi Nh·∫≠n Xe *</label>
                            <input type="text" id="receiver" placeholder="T√™n ng∆∞·ªùi nh·∫≠n xe" required>
                        </div>
                    </div>
                </div>
                
                <!-- B∆∞·ªõc 2: Ch·ªçn xe c·∫ßn xu·∫•t -->
                <div class="form-section">
                    <h3>2. Ch·ªçn Xe C·∫ßn Xu·∫•t</h3>
                    <div class="form-row">
                        <div class="form-group">
                            <label>T√¨m Ki·∫øm Xe</label>
                            <input type="text" id="searchVehicle" placeholder="Nh·∫≠p VIN ho·∫∑c m√£ xe ƒë·ªÉ t√¨m ki·∫øm">
                        </div>
                        <div class="form-group">
                            <label>&nbsp;</label>
                            <button class="btn btn-primary" onclick="searchVehicleInStock()">üîç T√¨m Ki·∫øm</button>
                        </div>
                    </div>
                    
                    <div id="searchResult" style="display: none; margin-top: 15px;">
                        <div class="vehicle-item" id="searchResultItem">
                            <!-- K·∫øt qu·∫£ t√¨m ki·∫øm s·∫Ω hi·ªÉn th·ªã ·ªü ƒë√¢y -->
                        </div>
                    </div>
                </div>
                
                <!-- Danh s√°ch xe ƒë√£ ch·ªçn ƒë·ªÉ xu·∫•t -->
                <div id="exportVehicleListSection" style="display: none;">
                    <h3>Danh S√°ch Xe ƒê√£ Ch·ªçn ƒê·ªÉ Xu·∫•t</h3>
                    <div class="vehicle-list" id="exportVehicleList"></div>
                </div>
                
                <!-- B∆∞·ªõc 3: Nh·∫≠p th√¥ng tin giao xe -->
                <div class="form-section">
                    <h3>3. Nh·∫≠p Th√¥ng Tin Giao Xe</h3>
                    <div class="form-row">
                        <div class="form-group">
                            <label>Nh√¢n Vi√™n Ph·ª• Tr√°ch Giao Xe *</label>
                            <input type="text" id="deliveryStaff" placeholder="T√™n nh√¢n vi√™n giao xe" required>
                        </div>
                        <div class="form-group">
                            <label>S·ªë ƒêi·ªán Tho·∫°i *</label>
                            <input type="tel" id="staffPhone" placeholder="S·ªë ƒëi·ªán tho·∫°i nh√¢n vi√™n" required>
                        </div>
                    </div>
                    
                    <h4 style="margin-top: 20px; color: #667eea;">Ki·ªÉm Tra ƒêi·ªÅu Ki·ªán Giao Xe</h4>
                    <div class="form-group">
                        <label style="display: flex; align-items: center; gap: 10px;">
                            <input type="checkbox" id="paymentCheck" style="width: auto;">
                            ƒê√£ thanh to√°n ƒë·∫ßy ƒë·ªß
                        </label>
                    </div>
                    <div class="form-group">
                        <label style="display: flex; align-items: center; gap: 10px;">
                            <input type="checkbox" id="contractCheck" style="width: auto;">
                            H·ª£p ƒë·ªìng h·ª£p l·ªá
                        </label>
                    </div>
                    <div class="form-group">
                        <label>Ghi Ch√∫</label>
                        <textarea id="exportNotes" rows="3" placeholder="Ghi ch√∫ th√™m v·ªÅ vi·ªác giao xe"></textarea>
                    </div>
                </div>
                
                <!-- B∆∞·ªõc 4: ƒê√≠nh k√®m ch·ª©ng t·ª´ xu·∫•t xe -->
                <div class="form-section">
                    <h3>4. ƒê√≠nh K√®m Ch·ª©ng T·ª´ Xu·∫•t Xe</h3>
                    <p style="margin-bottom: 15px; color: #666;">
                        <strong>Ch·ª©ng t·ª´ b·∫Øt bu·ªôc:</strong> H·ª£p ƒë·ªìng b√°n/chuy·ªÉn, H√≥a ƒë∆°n, Bi√™n b·∫£n b√†n giao xe (PDF/JPG)
                    </p>
                    
                    <div class="file-upload" onclick="document.getElementById('exportFileInput').click()">
                        <p>üìé Nh·∫•p ƒë·ªÉ t·∫£i l√™n ch·ª©ng t·ª´</p>
                        <small>H·ªó tr·ª£: PDF, JPG, PNG (T·ªëi ƒëa 5MB/file)</small>
                    </div>
                    <input type="file" id="exportFileInput" style="display: none;" accept=".pdf,.jpg,.jpeg,.png" multiple onchange="handleExportFileUpload(event)">
                    
                    <div class="file-list" id="exportFileList"></div>
                    
                    <div style="margin-top: 15px;">
                        <strong>Tr·∫°ng th√°i ch·ª©ng t·ª´: </strong>
                        <span class="status-badge status-draft" id="exportDocumentStatus">Ch∆∞a ƒë·∫ßy ƒë·ªß</span>
                    </div>
                </div>
                
                <!-- B∆∞·ªõc 5: X√°c nh·∫≠n v√† l∆∞u phi·∫øu xu·∫•t -->
                <div class="form-section">
                    <h3>5. X√°c Nh·∫≠n v√† L∆∞u Phi·∫øu Xu·∫•t</h3>
                    <div class="alert alert-warning" style="display: block;">
                        ‚ö†Ô∏è Vui l√≤ng ki·ªÉm tra k·ªπ to√†n b·ªô th√¥ng tin tr∆∞·ªõc khi g·ª≠i duy·ªát!
                    </div>
                    
                    <div class="btn-actions">
                        <button class="btn btn-primary" onclick="saveExportDraft()">üíæ L∆∞u Nh√°p</button>
                        <button class="btn btn-success" onclick="submitExportForApproval()" id="exportSubmitBtn" disabled>‚úì L∆∞u v√† G·ª≠i Duy·ªát</button>
                        <button class="btn btn-secondary" onclick="resetExportForm()">‚Üª L√†m M·ªõi</button>
                    </div>
                </div>
                
                <!-- Qu·∫£n l√Ω phi·∫øu xu·∫•t ch·ªù duy·ªát -->
                <div class="form-section" style="background: #fff3cd; border-color: #ffc107;">
                    <h3>6. Qu·∫£n L√Ω Kho - Duy·ªát Phi·∫øu Xu·∫•t</h3>
                    <p style="margin-bottom: 15px; color: #856404;">
                        <strong>D√†nh cho Qu·∫£n l√Ω kho:</strong> Ki·ªÉm tra v√† duy·ªát c√°c phi·∫øu xu·∫•t ch·ªù x·ª≠ l√Ω
                    </p>
                    
                    <div id="pendingExportList">
                        <p style="color: #666; text-align: center; padding: 20px;">Ch∆∞a c√≥ phi·∫øu xu·∫•t n√†o ch·ªù duy·ªát</p>
                    </div>
                </div>
            </div>
            
            <!-- KI·ªÇM K√ä -->
            <div id="kiem-ke" class="section">
                <h2>üìä Ki·ªÉm K√™ v√† Theo D√µi T·ªìn Kho</h2>
                
                <div class="alert alert-error" id="inventoryErrorAlert"></div>
                <div class="alert alert-success" id="inventorySuccessAlert"></div>
                
                <!-- B∆∞·ªõc 1: M·ªü m√†n h√¨nh ki·ªÉm k√™ -->
                <div class="form-section">
                    <h3>1. M·ªü M√†n H√¨nh Ki·ªÉm K√™ Kho</h3>
                    <div class="form-row">
                        <div class="form-group">
                            <label>Ch·ªçn Chi Nh√°nh/Khu V·ª±c Kho *</label>
                            <select id="inventoryWarehouse" onchange="loadInventoryData()">
                                <option value="">-- Ch·ªçn kho --</option>
                                <option value="kho-hcm">Kho TP.HCM</option>
                                <option value="kho-hn">Kho H√† N·ªôi</option>
                                <option value="kho-dn">Kho ƒê√† N·∫µng</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Ng√†y Ki·ªÉm K√™ *</label>
                            <input type="date" id="inventoryDate">
                        </div>
                    </div>
                    <button class="btn btn-primary" onclick="loadInventoryData()">üìã T·∫£i Danh S√°ch T·ªìn Kho</button>
                </div>
                
                <!-- Danh s√°ch xe t·ªìn kho hi·ªán t·∫°i -->
                <div id="currentStockSection" style="display: none;">
                    <div class="form-section">
                        <h3>Danh S√°ch Xe T·ªìn Kho Hi·ªán T·∫°i</h3>
                        <div style="overflow-x: auto;">
                            <table style="width: 100%; border-collapse: collapse; margin-top: 15px;">
                                <thead>
                                    <tr style="background: #667eea; color: white;">
                                        <th style="padding: 10px; border: 1px solid #ddd;">STT</th>
                                        <th style="padding: 10px; border: 1px solid #ddd;">H√£ng xe</th>
                                        <th style="padding: 10px; border: 1px solid #ddd;">D√≤ng xe</th>
                                        <th style="padding: 10px; border: 1px solid #ddd;">M√†u s·∫Øc</th>
                                        <th style="padding: 10px; border: 1px solid #ddd;">VIN</th>
                                        <th style="padding: 10px; border: 1px solid #ddd;">S·ªë m√°y</th>
                                        <th style="padding: 10px; border: 1px solid #ddd;">Tr·∫°ng th√°i</th>
                                    </tr>
                                </thead>
                                <tbody id="currentStockTable">
                                </tbody>
                            </table>
                        </div>
                        <div style="margin-top: 15px; padding: 15px; background: #e3f2fd; border-radius: 5px;">
                            <strong>T·ªïng s·ªë xe trong h·ªá th·ªëng: <span id="systemCount">0</span> xe</strong>
                        </div>
                    </div>
                </div>
                
                <!-- B∆∞·ªõc 2 & 3: Th·ª±c hi·ªán ki·ªÉm k√™ v√† nh·∫≠p k·∫øt qu·∫£ -->
                <div id="inventoryFormSection" style="display: none;">
                    <div class="form-section">
                        <h3>2 & 3. Th·ª±c Hi·ªán Ki·ªÉm K√™ v√† Nh·∫≠p K·∫øt Qu·∫£</h3>
                        
                        <div class="form-group">
                            <label>S·ªë Phi·∫øu Ki·ªÉm K√™ *</label>
                            <input type="text" id="inventoryNumber" placeholder="V√≠ d·ª•: PKK-2025-001">
                        </div>
                        
                        <div class="form-group">
                            <label>Ng∆∞·ªùi Ki·ªÉm K√™ *</label>
                            <input type="text" id="inventoryStaff" placeholder="T√™n nh√¢n vi√™n th·ª±c hi·ªán ki·ªÉm k√™">
                        </div>
                        
                        <h4 style="margin: 20px 0 10px 0; color: #667eea;">Nh·∫≠p S·ªë L∆∞·ª£ng Th·ª±c T·∫ø</h4>
                        <div style="overflow-x: auto;">
                            <table style="width: 100%; border-collapse: collapse;">
                                <thead>
                                    <tr style="background: #667eea; color: white;">
                                        <th style="padding: 10px; border: 1px solid #ddd;">H√£ng xe</th>
                                        <th style="padding: 10px; border: 1px solid #ddd;">D√≤ng xe</th>
                                        <th style="padding: 10px; border: 1px solid #ddd;">M√†u</th>
                                        <th style="padding: 10px; border: 1px solid #ddd;">VIN</th>
                                        <th style="padding: 10px; border: 1px solid #ddd;">S·ªï s√°ch</th>
                                        <th style="padding: 10px; border: 1px solid #ddd;">Th·ª±c t·∫ø</th>
                                        <th style="padding: 10px; border: 1px solid #ddd;">Ch√™nh l·ªách</th>
                                        <th style="padding: 10px; border: 1px solid #ddd;">L√Ω do</th>
                                    </tr>
                                </thead>
                                <tbody id="inventoryCheckTable">
                                </tbody>
                            </table>
                        </div>
                        
                        <div style="margin-top: 20px; padding: 15px; background: #fff3cd; border-radius: 5px;">
                            <strong>üìù H∆∞·ªõng d·∫´n:</strong><br>
                            <small>- Nh·∫≠p s·ªë l∆∞·ª£ng th·ª±c t·∫ø ƒë·∫øm ƒë∆∞·ª£c ·ªü c·ªôt "Th·ª±c t·∫ø"</small><br>
                            <small>- N·∫øu c√≥ ch√™nh l·ªách, ghi r√µ l√Ω do: M·∫•t, Sai l·ªách ch·ª©ng t·ª´, Chuy·ªÉn kho ch∆∞a c·∫≠p nh·∫≠t, v.v.</small><br>
                            <small>- H·ªá th·ªëng t·ª± ƒë·ªông t√≠nh ch√™nh l·ªách = Th·ª±c t·∫ø - S·ªï s√°ch</small>
                        </div>
                        
                        <div class="form-group" style="margin-top: 20px;">
                            <label>Ghi Ch√∫ Chung</label>
                            <textarea id="inventoryNotes" rows="3" placeholder="Ghi ch√∫ v·ªÅ qu√° tr√¨nh ki·ªÉm k√™"></textarea>
                        </div>
                    </div>
                </div>
                
                <!-- B∆∞·ªõc 4: L∆∞u v√† g·ª≠i duy·ªát -->
                <div id="inventoryActionsSection" style="display: none;">
                    <div class="form-section">
                        <h3>4. L∆∞u v√† G·ª≠i Duy·ªát Phi·∫øu Ki·ªÉm K√™</h3>
                        <div class="alert alert-warning" style="display: block;">
                            ‚ö†Ô∏è Vui l√≤ng ki·ªÉm tra k·ªπ to√†n b·ªô d·ªØ li·ªáu tr∆∞·ªõc khi g·ª≠i duy·ªát!
                        </div>
                        
                        <div class="btn-actions">
                            <button class="btn btn-primary" onclick="saveInventoryDraft()">üíæ L∆∞u Nh√°p</button>
                            <button class="btn btn-success" onclick="submitInventoryForApproval()">‚úì L∆∞u v√† G·ª≠i Duy·ªát</button>
                            <button class="btn btn-secondary" onclick="resetInventoryForm()">‚Üª L√†m M·ªõi</button>
                        </div>
                    </div>
                </div>
                
                <!-- B∆∞·ªõc 5: Qu·∫£n l√Ω kho duy·ªát -->
                <div class="form-section" style="background: #fff3cd; border-color: #ffc107;">
                    <h3>5. Qu·∫£n L√Ω Kho - Duy·ªát Phi·∫øu Ki·ªÉm K√™</h3>
                    <p style="margin-bottom: 15px; color: #856404;">
                        <strong>D√†nh cho Qu·∫£n l√Ω kho:</strong> Xem v√† duy·ªát c√°c phi·∫øu ki·ªÉm k√™ ch·ªù x·ª≠ l√Ω
                    </p>
                    
                    <div id="pendingInventoryList">
                        <p style="color: #666; text-align: center; padding: 20px;">Ch∆∞a c√≥ phi·∫øu ki·ªÉm k√™ n√†o ch·ªù duy·ªát</p>
                    </div>
                </div>
                
                <!-- B∆∞·ªõc 6: Xem b√°o c√°o t·ªìn kho -->
                <div class="form-section">
                    <h3>6. Xem B√°o C√°o T·ªìn Kho v√† L·ªãch S·ª≠ Ki·ªÉm K√™</h3>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label>T·ª´ Ng√†y</label>
                            <input type="date" id="reportFromDate">
                        </div>
                        <div class="form-group">
                            <label>ƒê·∫øn Ng√†y</label>
                            <input type="date" id="reportToDate">
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label>L·ªçc Theo Chi Nh√°nh</label>
                            <select id="reportWarehouse">
                                <option value="">-- T·∫•t c·∫£ --</option>
                                <option value="kho-hcm">Kho TP.HCM</option>
                                <option value="kho-hn">Kho H√† N·ªôi</option>
                                <option value="kho-dn">Kho ƒê√† N·∫µng</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>L·ªçc Theo H√£ng Xe</label>
                            <select id="reportBrand">
                                <option value="">-- T·∫•t c·∫£ --</option>
                                <option value="toyota">Toyota</option>
                                <option value="honda">Honda</option>
                                <option value="mazda">Mazda</option>
                                <option value="hyundai">Hyundai</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="btn-actions">
                        <button class="btn btn-primary" onclick="generateInventoryReport()">üìä Xem B√°o C√°o</button>
                        <button class="btn btn-success" onclick="exportToExcel()">üì• Xu·∫•t Excel</button>
                        <button class="btn btn-secondary" onclick="exportToPDF()">üìÑ Xu·∫•t PDF</button>
                    </div>
                    
                    <div id="reportSection" style="display: none; margin-top: 20px;">
                        <h4 style="color: #667eea;">B√°o C√°o T·ªìn Kho</h4>
                        <div style="overflow-x: auto;">
                            <table style="width: 100%; border-collapse: collapse; margin-top: 15px;">
                                <thead>
                                    <tr style="background: #667eea; color: white;">
                                        <th style="padding: 10px; border: 1px solid #ddd;">D√≤ng xe</th>
                                        <th style="padding: 10px; border: 1px solid #ddd;">T·ªìn ƒë·∫ßu k·ª≥</th>
                                        <th style="padding: 10px; border: 1px solid #ddd;">Nh·∫≠p</th>
                                        <th style="padding: 10px; border: 1px solid #ddd;">Xu·∫•t</th>
                                        <th style="padding: 10px; border: 1px solid #ddd;">T·ªìn cu·ªëi k·ª≥</th>
                                        <th style="padding: 10px; border: 1px solid #ddd;">Ch√™nh l·ªách KK</th>
                                    </tr>
                                </thead>
                                <tbody id="reportTable">
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- B√ÅO C√ÅO -->
            <div id="bao-cao" class="section">
                <div class="coming-soon">
                    <h2>üìà B√°o C√°o v√† D·ª± B√°o Kho</h2>
                    <p>Ch·ª©c nƒÉng ƒëang ph√°t tri·ªÉn...</p>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        let vehicles = [];
        let uploadedFiles = [];
        let vinDatabase = []; // M√¥ ph·ªèng CSDL VIN
        
        // D·ªØ li·ªáu cho xu·∫•t xe
        let exportVehicles = [];
        let exportFiles = [];
        let stockVehicles = [
            { vin: 'JTNK4RBE1A3123456', brand: 'Toyota', model: 'Vios', color: 'Tr·∫Øng', version: '1.5G CVT', status: 'C√≤n trong kho', sold: false, warranty: false },
            { vin: 'MHFGD38608K123789', brand: 'Honda', model: 'City', color: 'ƒêen', version: 'RS', status: 'C√≤n trong kho', sold: false, warranty: false },
            { vin: 'JM3KFBDM1N0123456', brand: 'Mazda', model: 'CX-5', color: 'ƒê·ªè', version: '2.0 Premium', status: 'C√≤n trong kho', sold: false, warranty: false }
        ]; // Xe m·∫´u trong kho
        let pendingExports = []; // Phi·∫øu xu·∫•t ch·ªù duy·ªát
        
        // Set ng√†y hi·ªán t·∫°i
        document.getElementById('receiptDate').value = new Date().toISOString().split('T')[0];
        document.getElementById('exportDate').value = new Date().toISOString().split('T')[0];
        
        // Hi·ªÉn th·ªã section
        function showSection(sectionId) {
            document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
            document.querySelectorAll('.menu-btn').forEach(b => b.classList.remove('active'));
            
            document.getElementById(sectionId).classList.add('active');
            event.target.classList.add('active');
            
            // C·∫≠p nh·∫≠t danh s√°ch phi·∫øu ch·ªù duy·ªát khi v√†o tab xu·∫•t xe
            if (sectionId === 'xuat-xe') {
                updatePendingExportList();
            }
        }
        
        // C·∫≠p nh·∫≠t tr·∫°ng th√°i phi·∫øu
        document.getElementById('receiptStatus').addEventListener('change', function() {
            const badge = document.getElementById('statusBadge');
            if (this.value === 'draft') {
                badge.textContent = 'Nh√°p';
                badge.className = 'status-badge status-draft';
            } else {
                badge.textContent = 'Ch∆∞a x√°c nh·∫≠n';
                badge.className = 'status-badge status-pending';
            }
        });
        
        // Ki·ªÉm tra ƒë·ªãnh d·∫°ng VIN
        function validateVIN(vin) {
            if (vin.length !== 17) {
                return { valid: false, message: 'VIN ph·∫£i c√≥ ƒë√∫ng 17 k√Ω t·ª±' };
            }
            if (!/^[A-HJ-NPR-Z0-9]+$/i.test(vin)) {
                return { valid: false, message: 'VIN ch·ª©a k√Ω t·ª± kh√¥ng h·ª£p l·ªá (kh√¥ng ƒë∆∞·ª£c ch·ª©a I, O, Q)' };
            }
            return { valid: true, message: '' };
        }
        
        // Ki·ªÉm tra tr√πng VIN
        function checkDuplicateVIN(vin) {
            return vinDatabase.includes(vin);
        }
        
        // Th√™m xe v√†o phi·∫øu
        function addVehicle() {
            const vin = document.getElementById('vin').value.trim().toUpperCase();
            const engineNumber = document.getElementById('engineNumber').value.trim();
            
            // Validate VIN
            const vinCheck = validateVIN(vin);
            if (!vinCheck.valid) {
                showAlert('error', vinCheck.message);
                return;
            }
            
            // Ki·ªÉm tra tr√πng VIN
            if (checkDuplicateVIN(vin)) {
                showAlert('error', `‚ùå L·ªói: VIN "${vin}" ƒë√£ t·ªìn t·∫°i trong c∆° s·ªü d·ªØ li·ªáu!`);
                return;
            }
            
            // Ki·ªÉm tra tr√πng s·ªë m√°y
            if (vehicles.some(v => v.engineNumber === engineNumber)) {
                showAlert('error', `‚ùå L·ªói: S·ªë m√°y "${engineNumber}" ƒë√£ ƒë∆∞·ª£c nh·∫≠p trong phi·∫øu n√†y!`);
                return;
            }
            
            // Ki·ªÉm tra c√°c tr∆∞·ªùng b·∫Øt bu·ªôc
            const brand = document.getElementById('brand').value;
            const model = document.getElementById('model').value.trim();
            const color = document.getElementById('color').value.trim();
            const version = document.getElementById('version').value.trim();
            const purchasePrice = document.getElementById('purchasePrice').value;
            
            if (!brand || !model || !color || !version || !vin || !engineNumber || !purchasePrice) {
                showAlert('error', 'Vui l√≤ng ƒëi·ªÅn ƒë·∫ßy ƒë·ªß c√°c tr∆∞·ªùng b·∫Øt bu·ªôc (*)');
                return;
            }
            
            // Th√™m xe v√†o danh s√°ch
            const vehicle = {
                brand: brand,
                model: model,
                color: color,
                version: version,
                vin: vin,
                engineNumber: engineNumber,
                plateNumber: document.getElementById('plateNumber').value.trim(),
                purchasePrice: parseFloat(purchasePrice),
                tax: parseFloat(document.getElementById('tax').value) || 0,
                shippingFee: parseFloat(document.getElementById('shippingFee').value) || 0,
                storageLocation: document.getElementById('storageLocation').value.trim()
            };
            
            vehicles.push(vehicle);
            vinDatabase.push(vin); // Th√™m v√†o CSDL
            
            updateVehicleList();
            clearVehicleForm();
            showAlert('success', '‚úì ƒê√£ th√™m xe th√†nh c√¥ng!');
        }
        
        // C·∫≠p nh·∫≠t danh s√°ch xe
        function updateVehicleList() {
            const listSection = document.getElementById('vehicleListSection');
            const list = document.getElementById('vehicleList');
            
            if (vehicles.length > 0) {
                listSection.style.display = 'block';
                list.innerHTML = vehicles.map((v, index) => `
                    <div class="vehicle-item">
                        <strong>Xe ${index + 1}:</strong> ${v.brand} ${v.model} - ${v.color} - ${v.version}<br>
                        <small>VIN: ${v.vin} | S·ªë m√°y: ${v.engineNumber} | Gi√°: ${v.purchasePrice.toLocaleString('vi-VN')} VNƒê</small>
                        <button class="btn btn-secondary" style="margin-top: 10px; padding: 5px 10px; font-size: 12px;" onclick="removeVehicle(${index})">X√≥a</button>
                    </div>
                `).join('');
            } else {
                listSection.style.display = 'none';
            }
        }
        
        // X√≥a xe
        function removeVehicle(index) {
            const vin = vehicles[index].vin;
            vinDatabase = vinDatabase.filter(v => v !== vin);
            vehicles.splice(index, 1);
            updateVehicleList();
        }
        
        // X√≥a form xe
        function clearVehicleForm() {
            document.getElementById('brand').value = '';
            document.getElementById('model').value = '';
            document.getElementById('color').value = '';
            document.getElementById('version').value = '';
            document.getElementById('vin').value = '';
            document.getElementById('engineNumber').value = '';
            document.getElementById('plateNumber').value = '';
            document.getElementById('purchasePrice').value = '';
            document.getElementById('tax').value = '';
            document.getElementById('shippingFee').value = '';
            document.getElementById('storageLocation').value = '';
        }
        
        // X·ª≠ l√Ω t·∫£i file
        function handleFileUpload(event) {
            const files = Array.from(event.target.files);
            
            for (let file of files) {
                // Ki·ªÉm tra ƒë·ªãnh d·∫°ng
                const validTypes = ['application/pdf', 'image/jpeg', 'image/jpg', 'image/png'];
                if (!validTypes.includes(file.type)) {
                    showAlert('error', `File "${file.name}" kh√¥ng ƒë√∫ng ƒë·ªãnh d·∫°ng (ch·ªâ ch·∫•p nh·∫≠n PDF, JPG, PNG)`);
                    continue;
                }
                
                // Ki·ªÉm tra k√≠ch th∆∞·ªõc (5MB)
                if (file.size > 5 * 1024 * 1024) {
                    showAlert('error', `File "${file.name}" v∆∞·ª£t qu√° 5MB`);
                    continue;
                }
                
                uploadedFiles.push(file);
            }
            
            updateFileList();
            checkDocumentCompleteness();
        }
        
        // C·∫≠p nh·∫≠t danh s√°ch file
        function updateFileList() {
            const list = document.getElementById('fileList');
            list.innerHTML = uploadedFiles.map((file, index) => `
                <div class="file-item">
                    <span>üìÑ ${file.name} (${(file.size / 1024).toFixed(1)} KB)</span>
                    <button class="btn btn-secondary" style="padding: 5px 10px; font-size: 12px;" onclick="removeFile(${index})">X√≥a</button>
                </div>
            `).join('');
        }
        
        // X√≥a file
        function removeFile(index) {
            uploadedFiles.splice(index, 1);
            updateFileList();
            checkDocumentCompleteness();
        }
        
        // Ki·ªÉm tra ch·ª©ng t·ª´ ƒë·∫ßy ƒë·ªß
        function checkDocumentCompleteness() {
            const statusBadge = document.getElementById('documentStatus');
            const submitBtn = document.getElementById('submitBtn');
            const alert = document.getElementById('documentAlert');
            
            if (uploadedFiles.length >= 2) { // T·ªëi thi·ªÉu 2 ch·ª©ng t·ª´
                statusBadge.textContent = 'Ch·ª©ng t·ª´ ho√†n t·∫•t';
                statusBadge.className = 'status-badge status-complete';
                submitBtn.disabled = false;
                alert.classList.remove('show');
            } else {
                statusBadge.textContent = 'Ch∆∞a ƒë·∫ßy ƒë·ªß';
                statusBadge.className = 'status-badge status-draft';
                submitBtn.disabled = true;
                alert.classList.add('show');
            }
        }
        
        // Hi·ªÉn th·ªã th√¥ng b√°o
        function showAlert(type, message) {
            const alertBox = document.getElementById(type === 'error' ? 'errorAlert' : 'successAlert');
            alertBox.textContent = message;
            alertBox.classList.add('show');
            
            setTimeout(() => {
                alertBox.classList.remove('show');
            }, 5000);
        }
        
        // L∆∞u nh√°p
        function saveDraft() {
            const warehouse = document.getElementById('warehouse').value;
            const supplier = document.getElementById('supplier').value;
            const receiptNumber = document.getElementById('receiptNumber').value;
            
            if (!warehouse || !supplier || !receiptNumber) {
                showAlert('error', 'Vui l√≤ng ƒëi·ªÅn ƒë·∫ßy ƒë·ªß th√¥ng tin phi·∫øu nh·∫≠p');
                return;
            }
            
            showAlert('success', '‚úì ƒê√£ l∆∞u phi·∫øu nh·∫≠p d∆∞·ªõi d·∫°ng nh√°p!');
        }
        
        // G·ª≠i duy·ªát
        function submitForApproval() {
            if (vehicles.length === 0) {
                showAlert('error', 'Vui l√≤ng th√™m √≠t nh·∫•t m·ªôt xe v√†o phi·∫øu nh·∫≠p');
                return;
            }
            
            if (uploadedFiles.length < 2) {
                showAlert('error', '‚ö†Ô∏è Kh√¥ng th·ªÉ g·ª≠i duy·ªát: Ch·ª©ng t·ª´ ch∆∞a ƒë·∫ßy ƒë·ªß!');
                return;
            }
            
            showAlert('success', '‚úì Phi·∫øu nh·∫≠p ƒë√£ ƒë∆∞·ª£c g·ª≠i ƒë·ªÉ duy·ªát th√†nh c√¥ng!');
            setTimeout(() => {
                resetForm();
            }, 2000);
        }
        
        // Reset form
        function resetForm() {
            document.querySelectorAll('input, select, textarea').forEach(el => {
                if (el.type === 'checkbox' || el.type === 'radio') {
                    el.checked = false;
                } else if (el.type !== 'date') {
                    el.value = '';
                }
            });
            
            // Reset l·∫°i ng√†y hi·ªán t·∫°i
            document.getElementById('receiptDate').value = new Date().toISOString().split('T')[0];
            
            // Reset tr·∫°ng th√°i
            document.getElementById('receiptStatus').value = 'draft';
            document.getElementById('statusBadge').textContent = 'Nh√°p';
            document.getElementById('statusBadge').className = 'status-badge status-draft';
            
            // X√≥a danh s√°ch xe v√† file
            vehicles = [];
            uploadedFiles = [];
            vinDatabase = []; // Reset CSDL VIN
            
            updateVehicleList();
            updateFileList();
            checkDocumentCompleteness();
            
            // ·∫®n th√¥ng b√°o
            document.querySelectorAll('.alert').forEach(alert => alert.classList.remove('show'));
            
            showAlert('success', '‚úì ƒê√£ l√†m m·ªõi form th√†nh c√¥ng!');
        }
        
        // ============ CH·ª®C NƒÇNG XU·∫§T XE ============
        
        // T√¨m ki·∫øm xe trong kho
        function searchVehicleInStock() {
            const searchTerm = document.getElementById('searchVehicle').value.trim().toUpperCase();
            
            if (!searchTerm) {
                showExportAlert('error', 'Vui l√≤ng nh·∫≠p VIN ho·∫∑c m√£ xe ƒë·ªÉ t√¨m ki·∫øm');
                return;
            }
            
            const vehicle = stockVehicles.find(v => v.vin === searchTerm);
            
            if (!vehicle) {
                showExportAlert('error', `Kh√¥ng t√¨m th·∫•y xe v·ªõi VIN/M√£: ${searchTerm}`);
                document.getElementById('searchResult').style.display = 'none';
                return;
            }
            
            // Ki·ªÉm tra t√¨nh tr·∫°ng xe
            if (vehicle.sold) {
                showExportAlert('error', `‚ö†Ô∏è Xe n√†y ƒë√£ ƒë∆∞·ª£c b√°n, kh√¥ng th·ªÉ xu·∫•t!`);
                return;
            }
            
            if (vehicle.warranty) {
                showExportAlert('error', `‚ö†Ô∏è Xe n√†y ƒëang trong qu√° tr√¨nh b·∫£o h√†nh!`);
                return;
            }
            
            // Hi·ªÉn th·ªã k·∫øt qu·∫£
            const resultDiv = document.getElementById('searchResultItem');
            resultDiv.innerHTML = `
                <div style="display: flex; justify-content: space-between; align-items: center;">
                    <div>
                        <strong>${vehicle.brand} ${vehicle.model}</strong> - ${vehicle.color} - ${vehicle.version}<br>
                        <small>VIN: ${vehicle.vin}</small><br>
                        <small>T√¨nh tr·∫°ng: <span style="color: #28a745; font-weight: 600;">${vehicle.status}</span></small>
                    </div>
                    <button class="btn btn-success" onclick="addVehicleToExport('${vehicle.vin}')">‚ûï Th√™m V√†o Phi·∫øu</button>
                </div>
            `;
            document.getElementById('searchResult').style.display = 'block';
            showExportAlert('success', '‚úì T√¨m th·∫•y xe! Xe h·ª£p l·ªá ƒë·ªÉ xu·∫•t.');
        }
        
        // Th√™m xe v√†o phi·∫øu xu·∫•t
        function addVehicleToExport(vin) {
            const vehicle = stockVehicles.find(v => v.vin === vin);
            
            // Ki·ªÉm tra xe ƒë√£ c√≥ trong danh s√°ch ch∆∞a
            if (exportVehicles.some(v => v.vin === vin)) {
                showExportAlert('error', 'Xe n√†y ƒë√£ c√≥ trong danh s√°ch xu·∫•t!');
                return;
            }
            
            exportVehicles.push(vehicle);
            updateExportVehicleList();
            showExportAlert('success', '‚úì ƒê√£ th√™m xe v√†o phi·∫øu xu·∫•t!');
            
            // X√≥a k·∫øt qu·∫£ t√¨m ki·∫øm
            document.getElementById('searchVehicle').value = '';
            document.getElementById('searchResult').style.display = 'none';
        }
        
        // C·∫≠p nh·∫≠t danh s√°ch xe xu·∫•t
        function updateExportVehicleList() {
            const listSection = document.getElementById('exportVehicleListSection');
            const list = document.getElementById('exportVehicleList');
            
            if (exportVehicles.length > 0) {
                listSection.style.display = 'block';
                list.innerHTML = exportVehicles.map((v, index) => `
                    <div class="vehicle-item">
                        <strong>Xe ${index + 1}:</strong> ${v.brand} ${v.model} - ${v.color} - ${v.version}<br>
                        <small>VIN: ${v.vin} | T√¨nh tr·∫°ng: ${v.status}</small>
                        <button class="btn btn-secondary" style="margin-top: 10px; padding: 5px 10px; font-size: 12px;" onclick="removeExportVehicle(${index})">X√≥a</button>
                    </div>
                `).join('');
            } else {
                listSection.style.display = 'none';
            }
        }
        
        // X√≥a xe kh·ªèi phi·∫øu xu·∫•t
        function removeExportVehicle(index) {
            exportVehicles.splice(index, 1);
            updateExportVehicleList();
        }
        
        // X·ª≠ l√Ω t·∫£i file xu·∫•t xe
        function handleExportFileUpload(event) {
            const files = Array.from(event.target.files);
            
            for (let file of files) {
                const validTypes = ['application/pdf', 'image/jpeg', 'image/jpg', 'image/png'];
                if (!validTypes.includes(file.type)) {
                    showExportAlert('error', `File "${file.name}" kh√¥ng ƒë√∫ng ƒë·ªãnh d·∫°ng`);
                    continue;
                }
                
                if (file.size > 5 * 1024 * 1024) {
                    showExportAlert('error', `File "${file.name}" v∆∞·ª£t qu√° 5MB`);
                    continue;
                }
                
                exportFiles.push(file);
            }
            
            updateExportFileList();
            checkExportDocumentCompleteness();
        }
        
        // C·∫≠p nh·∫≠t danh s√°ch file xu·∫•t
        function updateExportFileList() {
            const list = document.getElementById('exportFileList');
            list.innerHTML = exportFiles.map((file, index) => `
                <div class="file-item">
                    <span>üìÑ ${file.name} (${(file.size / 1024).toFixed(1)} KB)</span>
                    <button class="btn btn-secondary" style="padding: 5px 10px; font-size: 12px;" onclick="removeExportFile(${index})">X√≥a</button>
                </div>
            `).join('');
        }
        
        // X√≥a file xu·∫•t
        function removeExportFile(index) {
            exportFiles.splice(index, 1);
            updateExportFileList();
            checkExportDocumentCompleteness();
        }
        
        // Ki·ªÉm tra ch·ª©ng t·ª´ xu·∫•t ƒë·∫ßy ƒë·ªß
        function checkExportDocumentCompleteness() {
            const statusBadge = document.getElementById('exportDocumentStatus');
            const submitBtn = document.getElementById('exportSubmitBtn');
            const alert = document.getElementById('exportDocumentAlert');
            const paymentCheck = document.getElementById('paymentCheck').checked;
            const contractCheck = document.getElementById('contractCheck').checked;
            
            if (exportFiles.length >= 2 && paymentCheck && contractCheck && exportVehicles.length > 0) {
                statusBadge.textContent = 'Ch·ª©ng t·ª´ ho√†n t·∫•t';
                statusBadge.className = 'status-badge status-complete';
                submitBtn.disabled = false;
                alert.classList.remove('show');
            } else {
                statusBadge.textContent = 'Ch∆∞a ƒë·∫ßy ƒë·ªß';
                statusBadge.className = 'status-badge status-draft';
                submitBtn.disabled = true;
                alert.classList.add('show');
            }
        }
        
        // Theo d√µi checkbox
        document.getElementById('paymentCheck').addEventListener('change', checkExportDocumentCompleteness);
        document.getElementById('contractCheck').addEventListener('change', checkExportDocumentCompleteness);
        
        // L∆∞u nh√°p phi·∫øu xu·∫•t
        function saveExportDraft() {
            const exportType = document.getElementById('exportType').value;
            const receiver = document.getElementById('receiver').value;
            const exportNumber = document.getElementById('exportNumber').value;
            
            if (!exportType || !receiver || !exportNumber) {
                showExportAlert('error', 'Vui l√≤ng ƒëi·ªÅn ƒë·∫ßy ƒë·ªß th√¥ng tin phi·∫øu xu·∫•t');
                return;
            }
            
            showExportAlert('success', '‚úì ƒê√£ l∆∞u phi·∫øu xu·∫•t d∆∞·ªõi d·∫°ng nh√°p!');
        }
        
        // G·ª≠i duy·ªát phi·∫øu xu·∫•t
        function submitExportForApproval() {
            if (exportVehicles.length === 0) {
                showExportAlert('error', 'Vui l√≤ng ch·ªçn √≠t nh·∫•t m·ªôt xe ƒë·ªÉ xu·∫•t');
                return;
            }
            
            if (exportFiles.length < 2) {
                showExportAlert('error', '‚ö†Ô∏è Kh√¥ng th·ªÉ g·ª≠i duy·ªát: Ch·ª©ng t·ª´ ch∆∞a ƒë·∫ßy ƒë·ªß!');
                return;
            }
            
            if (!document.getElementById('paymentCheck').checked || !document.getElementById('contractCheck').checked) {
                showExportAlert('error', '‚ö†Ô∏è Ch∆∞a ƒë√°p ·ª©ng ƒë·ªß ƒëi·ªÅu ki·ªán giao xe!');
                return;
            }
            
            // T·∫°o phi·∫øu xu·∫•t ch·ªù duy·ªát
            const exportOrder = {
                id: 'PX-' + Date.now(),
                exportNumber: document.getElementById('exportNumber').value,
                exportType: document.getElementById('exportType').value,
                exportDate: document.getElementById('exportDate').value,
                receiver: document.getElementById('receiver').value,
                deliveryStaff: document.getElementById('deliveryStaff').value,
                vehicles: [...exportVehicles],
                files: exportFiles.length,
                status: 'pending',
                notes: document.getElementById('exportNotes').value
            };
            
            pendingExports.push(exportOrder);
            updatePendingExportList();
            
            showExportAlert('success', '‚úì Phi·∫øu xu·∫•t ƒë√£ ƒë∆∞·ª£c g·ª≠i ƒë·ªÉ duy·ªát th√†nh c√¥ng!');
            setTimeout(() => {
                resetExportForm();
            }, 2000);
        }
        
        // C·∫≠p nh·∫≠t danh s√°ch phi·∫øu ch·ªù duy·ªát
        function updatePendingExportList() {
            const list = document.getElementById('pendingExportList');
            
            if (pendingExports.length === 0) {
                list.innerHTML = '<p style="color: #666; text-align: center; padding: 20px;">Ch∆∞a c√≥ phi·∫øu xu·∫•t n√†o ch·ªù duy·ªát</p>';
                return;
            }
            
            list.innerHTML = pendingExports.map((order, index) => `
                <div class="vehicle-item" style="border-left-color: #ffc107;">
                    <div style="display: flex; justify-content: space-between; align-items: start;">
                        <div>
                            <strong>Phi·∫øu: ${order.exportNumber}</strong> <span class="status-badge status-pending">Ch·ªù duy·ªát</span><br>
                            <small>Lo·∫°i: ${getExportTypeName(order.exportType)} | Ng√†y xu·∫•t: ${order.exportDate}</small><br>
                            <small>Ng∆∞·ªùi nh·∫≠n: ${order.receiver} | NV giao: ${order.deliveryStaff}</small><br>
                            <small>S·ªë xe: ${order.vehicles.length} | Ch·ª©ng t·ª´: ${order.files} file</small>
                        </div>
                        <div style="display: flex; gap: 5px; flex-direction: column;">
                            <button class="btn btn-success" style="padding: 8px 15px; font-size: 12px;" onclick="approveExport(${index})">‚úì Duy·ªát</button>
                            <button class="btn btn-secondary" style="padding: 8px 15px; font-size: 12px;" onclick="rejectExport(${index})">‚úó T·ª´ ch·ªëi</button>
                        </div>
                    </div>
                </div>
            `).join('');
        }
        
        // L·∫•y t√™n lo·∫°i xu·∫•t
        function getExportTypeName(type) {
            const types = {
                'sale': 'B√°n h√†ng',
                'transfer': 'Chuy·ªÉn chi nh√°nh',
                'warranty': 'B·∫£o h√†nh',
                'other': 'Kh√°c'
            };
            return types[type] || type;
        }
        
        // Duy·ªát phi·∫øu xu·∫•t
        function approveExport(index) {
            const order = pendingExports[index];
            
            // C·∫≠p nh·∫≠t tr·∫°ng th√°i xe trong kho
            order.vehicles.forEach(v => {
                const stockVehicle = stockVehicles.find(sv => sv.vin === v.vin);
                if (stockVehicle) {
                    if (order.exportType === 'sale') {
                        stockVehicle.sold = true;
                        stockVehicle.status = 'ƒê√£ b√°n';
                    } else if (order.exportType === 'warranty') {
                        stockVehicle.warranty = true;
                        stockVehicle.status = 'ƒêang b·∫£o h√†nh';
                    } else {
                        stockVehicle.status = 'ƒê√£ xu·∫•t kho';
                    }
                }
            });
            
            pendingExports.splice(index, 1);
            updatePendingExportList();
            showExportAlert('success', `‚úì ƒê√£ duy·ªát phi·∫øu xu·∫•t ${order.exportNumber}. T·ªìn kho ƒë√£ ƒë∆∞·ª£c c·∫≠p nh·∫≠t!`);
        }
        
        // T·ª´ ch·ªëi phi·∫øu xu·∫•t
        function rejectExport(index) {
            const reason = prompt('Nh·∫≠p l√Ω do t·ª´ ch·ªëi phi·∫øu xu·∫•t:');
            if (!reason) return;
            
            const order = pendingExports[index];
            pendingExports.splice(index, 1);
            updatePendingExportList();
            showExportAlert('error', `‚úó ƒê√£ t·ª´ ch·ªëi phi·∫øu xu·∫•t ${order.exportNumber}. L√Ω do: ${reason}`);
        }
        
        // Hi·ªÉn th·ªã th√¥ng b√°o xu·∫•t xe
        function showExportAlert(type, message) {
            const alertBox = document.getElementById(type === 'error' ? 'exportErrorAlert' : 'exportSuccessAlert');
            alertBox.textContent = message;
            alertBox.classList.add('show');
            
            setTimeout(() => {
                alertBox.classList.remove('show');
            }, 5000);
        }
        
        // Reset form xu·∫•t xe
        function resetExportForm() {
            document.querySelectorAll('#xuat-xe input, #xuat-xe select, #xuat-xe textarea').forEach(el => {
                if (el.type === 'checkbox') {
                    el.checked = false;
                } else if (el.type !== 'date') {
                    el.value = '';
                }
            });
            
            document.getElementById('exportDate').value = new Date().toISOString().split('T')[0];
            
            exportVehicles = [];
            exportFiles = [];
            
            updateExportVehicleList();
            updateExportFileList();
            checkExportDocumentCompleteness();
            
            document.getElementById('searchResult').style.display = 'none';
            document.querySelectorAll('#xuat-xe .alert').forEach(alert => alert.classList.remove('show'));
        }
    </script>
</body>
</html>