<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Qu·∫£n l√Ω Thu Ng√¢n</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 25px 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 28px;
            margin-bottom: 5px;
        }

        .header p {
            opacity: 0.9;
            font-size: 14px;
        }

        .menu-tabs {
            display: flex;
            background: #f8f9fa;
            border-bottom: 2px solid #e9ecef;
            overflow-x: auto;
        }

        .tab-btn {
            flex: 1;
            padding: 18px 20px;
            background: none;
            border: none;
            cursor: pointer;
            font-size: 15px;
            font-weight: 600;
            color: #6c757d;
            transition: all 0.3s;
            border-bottom: 3px solid transparent;
            min-width: 200px;
        }

        .tab-btn:hover {
            background: #e9ecef;
            color: #495057;
        }

        .tab-btn.active {
            color: #667eea;
            border-bottom-color: #667eea;
            background: white;
        }

        .tab-content {
            display: none;
            padding: 30px;
            animation: fadeIn 0.3s;
        }

        .tab-content.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .form-section {
            background: #f8f9fa;
            padding: 25px;
            border-radius: 10px;
            margin-bottom: 25px;
            border-left: 4px solid #667eea;
        }

        .form-section h3 {
            color: #667eea;
            margin-bottom: 20px;
            font-size: 18px;
            display: flex;
            align-items: center;
        }

        .form-section h3::before {
            content: "‚óè";
            margin-right: 10px;
            font-size: 12px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #495057;
            font-size: 14px;
        }

        .form-group input,
        .form-group select {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #dee2e6;
            border-radius: 8px;
            font-size: 14px;
            transition: border-color 0.3s;
        }

        .form-group input:focus,
        .form-group select:focus {
            outline: none;
            border-color: #667eea;
        }

        .btn {
            padding: 12px 30px;
            border: none;
            border-radius: 8px;
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            margin-right: 10px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .btn-success {
            background: #28a745;
            color: white;
        }

        .btn-success:hover {
            background: #218838;
            transform: translateY(-2px);
        }

        .btn-danger {
            background: #dc3545;
            color: white;
        }

        .btn-danger:hover {
            background: #c82333;
        }

        .btn-secondary {
            background: #6c757d;
            color: white;
        }

        .product-list {
            background: white;
            border: 2px solid #dee2e6;
            border-radius: 8px;
            padding: 15px;
            margin-top: 15px;
            max-height: 300px;
            overflow-y: auto;
        }

        .product-item {
            padding: 12px;
            border-bottom: 1px solid #e9ecef;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .product-item:last-child {
            border-bottom: none;
        }

        .total-amount {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 25px;
            border-radius: 10px;
            text-align: center;
            font-size: 24px;
            font-weight: bold;
            margin: 20px 0;
        }

        .payment-method-group {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }

        .payment-option {
            flex: 1;
            min-width: 150px;
            padding: 20px;
            border: 2px solid #dee2e6;
            border-radius: 10px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
        }

        .payment-option:hover {
            border-color: #667eea;
            background: #f8f9fa;
        }

        .payment-option.selected {
            border-color: #667eea;
            background: #e7f0ff;
        }

        .payment-option input[type="checkbox"] {
            margin-bottom: 10px;
        }

        .alert {
            padding: 15px 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            font-weight: 500;
        }

        .alert-success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .alert-info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }

        .grid-2 {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        .invoice-card {
            background: white;
            border: 2px solid #dee2e6;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 15px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .invoice-card:hover {
            border-color: #667eea;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .shift-status {
            display: inline-block;
            padding: 8px 15px;
            border-radius: 20px;
            font-weight: 600;
            font-size: 14px;
        }

        .shift-open {
            background: #d4edda;
            color: #155724;
        }

        .shift-closed {
            background: #f8d7da;
            color: #721c24;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            background: white;
            border-radius: 8px;
            overflow: hidden;
        }

        th {
            background: #667eea;
            color: white;
            padding: 15px;
            text-align: left;
            font-weight: 600;
        }

        td {
            padding: 12px 15px;
            border-bottom: 1px solid #e9ecef;
        }

        tr:hover {
            background: #f8f9fa;
        }

        @media (max-width: 768px) {
            .grid-2 {
                grid-template-columns: 1fr;
            }

            .menu-tabs {
                flex-direction: column;
            }

            .tab-btn {
                min-width: auto;
            }
        }

        .invoice-preview {
            background: white;
            border: 2px dashed #667eea;
            padding: 30px;
            border-radius: 10px;
            margin-top: 20px;
            font-family: 'Courier New', monospace;
        }

        .change-amount {
            font-size: 32px;
            color: #28a745;
            font-weight: bold;
            text-align: center;
            padding: 20px;
            background: #d4edda;
            border-radius: 10px;
            margin: 15px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üè™ H·ªÜ TH·ªêNG QU·∫¢N L√ù THU NG√ÇN</h1>
            <p>Phi√™n b·∫£n 1.0 - Chuy√™n nghi·ªáp & Hi·ªáu qu·∫£</p>
        </div>

        <div class="menu-tabs">
            <button class="tab-btn active" onclick="switchTab('sales')">X·ª≠ l√Ω Giao d·ªãch B√°n h√†ng</button>
            <button class="tab-btn" onclick="switchTab('invoices')">Qu·∫£n l√Ω H√≥a ƒë∆°n</button>
            <button class="tab-btn" onclick="switchTab('shift')">M·ªü/ƒê√≥ng Ca</button>
            <button class="tab-btn" onclick="switchTab('report')">B√°o c√°o Thu chi</button>
        </div>

        <!-- Tab 1: X·ª≠ l√Ω Giao d·ªãch B√°n h√†ng -->
        <div id="sales" class="tab-content active">
            <div class="form-section">
                <h3>B∆∞·ªõc 1: X√°c nh·∫≠n H√≥a ƒë∆°n</h3>
                <div class="grid-2">
                    <div class="form-group">
                        <label>M√£ ƒë∆°n h√†ng</label>
                        <input type="text" id="orderId" placeholder="Nh·∫≠p m√£ ƒë∆°n h√†ng">
                    </div>
                    <div class="form-group">
                        <label>M√£ kh√°ch h√†ng (T√πy ch·ªçn)</label>
                        <input type="text" id="customerId" placeholder="Nh·∫≠p m√£ kh√°ch h√†ng">
                    </div>
                </div>
                <button class="btn btn-primary" onclick="loadInvoice()">T·∫£i th√¥ng tin h√≥a ƒë∆°n</button>
                
                <div id="invoiceDetails" style="display:none; margin-top: 20px;">
                    <div class="alert alert-success">‚úì ƒê√£ t·∫£i th√†nh c√¥ng th√¥ng tin h√≥a ƒë∆°n</div>
                    <div class="product-list">
                        <div class="product-item">
                            <span><strong>S·∫£n ph·∫©m A</strong> - SL: 2</span>
                            <span>500,000 ƒë</span>
                        </div>
                        <div class="product-item">
                            <span><strong>S·∫£n ph·∫©m B</strong> - SL: 1</span>
                            <span>300,000 ƒë</span>
                        </div>
                        <div class="product-item">
                            <span><strong>D·ªãch v·ª• C</strong> - SL: 1</span>
                            <span>200,000 ƒë</span>
                        </div>
                    </div>
                    
                    <div class="form-group" style="margin-top: 20px;">
                        <label>S·ªë ƒëi·ªán tho·∫°i kh√°ch h√†ng th√†nh vi√™n (ƒê·ªÉ t√≠ch ƒëi·ªÉm)</label>
                        <input type="text" id="memberPhone" placeholder="Nh·∫≠p SƒêT ƒë·ªÉ t√≠ch ƒëi·ªÉm">
                    </div>
                </div>
            </div>

            <div class="form-section">
                <h3>B∆∞·ªõc 2: √Åp d·ª•ng Ch√≠nh s√°ch & Gi·∫£m gi√°</h3>
                <div class="grid-2">
                    <div class="form-group">
                        <label>M√£ khuy·∫øn m√£i / Voucher</label>
                        <input type="text" id="promoCode" placeholder="Nh·∫≠p m√£ gi·∫£m gi√°">
                    </div>
                    <div class="form-group">
                        <label>Chi·∫øt kh·∫•u (%)</label>
                        <input type="number" id="discount" value="0" min="0" max="100" onchange="calculateTotal()">
                    </div>
                </div>
                <button class="btn btn-primary" onclick="applyDiscount()">√Åp d·ª•ng gi·∫£m gi√°</button>
                
                <div class="total-amount" id="totalAmount">
                    T·ªîNG TI·ªÄN: 1,000,000 ƒë
                </div>
                <div class="total-amount" id="finalAmount" style="background: #28a745;">
                    PH·∫¢I THANH TO√ÅN: 1,000,000 ƒë
                </div>
            </div>

            <div class="form-section">
                <h3>B∆∞·ªõc 3: Ch·ªçn Ph∆∞∆°ng th·ª©c Thanh to√°n</h3>
                <div class="payment-method-group">
                    <div class="payment-option" onclick="togglePayment('cash')">
                        <input type="checkbox" id="payCash">
                        <div>üíµ Ti·ªÅn m·∫∑t</div>
                    </div>
                    <div class="payment-option" onclick="togglePayment('card')">
                        <input type="checkbox" id="payCard">
                        <div>üí≥ Th·∫ª</div>
                    </div>
                    <div class="payment-option" onclick="togglePayment('transfer')">
                        <input type="checkbox" id="payTransfer">
                        <div>üè¶ Chuy·ªÉn kho·∫£n</div>
                    </div>
                </div>

                <div id="cashInput" style="display:none; margin-top: 20px;">
                    <div class="form-group">
                        <label>S·ªë ti·ªÅn ti·ªÅn m·∫∑t</label>
                        <input type="number" id="cashAmount" placeholder="Nh·∫≠p s·ªë ti·ªÅn" onchange="calculateChange()">
                    </div>
                    <div class="form-group">
                        <label>S·ªë ti·ªÅn kh√°ch ƒë∆∞a</label>
                        <input type="number" id="cashGiven" placeholder="Nh·∫≠p s·ªë ti·ªÅn kh√°ch ƒë∆∞a" onchange="calculateChange()">
                    </div>
                    <div id="changeDisplay" class="change-amount" style="display:none;">
                        TI·ªÄN TH·ª™A: 0 ƒë
                    </div>
                </div>

                <div id="cardInput" style="display:none; margin-top: 20px;">
                    <div class="form-group">
                        <label>S·ªë ti·ªÅn thanh to√°n b·∫±ng th·∫ª</label>
                        <input type="number" id="cardAmount" placeholder="Nh·∫≠p s·ªë ti·ªÅn">
                    </div>
                    <div class="form-group">
                        <label>M√£ giao d·ªãch POS</label>
                        <input type="text" id="posTransaction" placeholder="Nh·∫≠p m√£ giao d·ªãch">
                    </div>
                </div>

                <div id="transferInput" style="display:none; margin-top: 20px;">
                    <div class="form-group">
                        <label>S·ªë ti·ªÅn chuy·ªÉn kho·∫£n</label>
                        <input type="number" id="transferAmount" placeholder="Nh·∫≠p s·ªë ti·ªÅn">
                    </div>
                    <div class="form-group">
                        <label>M√£ giao d·ªãch chuy·ªÉn kho·∫£n</label>
                        <input type="text" id="transferTransaction" placeholder="Nh·∫≠p m√£ giao d·ªãch">
                    </div>
                </div>
            </div>

            <div class="form-section">
                <h3>B∆∞·ªõc 4: Ho√†n t·∫•t Giao d·ªãch & In H√≥a ƒë∆°n</h3>
                <button class="btn btn-success" onclick="completeTransaction()" style="font-size: 18px; padding: 15px 40px;">
                    ‚úì HO√ÄN T·∫§T THANH TO√ÅN
                </button>
                <button class="btn btn-secondary" onclick="resetTransaction()">‚Ü∫ L√†m m·ªõi</button>
                
                <div id="invoicePreview" style="display:none;" class="invoice-preview">
                    <h2 style="text-align: center; border-bottom: 2px solid #000; padding-bottom: 10px;">H√ìA ƒê∆†N B√ÅN H√ÄNG</h2>
                    <p>M√£ ƒë∆°n: <strong id="invOrderId"></strong></p>
                    <p>Ng√†y: <strong id="invDate"></strong></p>
                    <p>Thu ng√¢n: <strong>Nguy·ªÖn VƒÉn A</strong></p>
                    <hr>
                    <div id="invProducts"></div>
                    <hr>
                    <p>T·ªïng ti·ªÅn: <strong id="invTotal"></strong></p>
                    <p>Gi·∫£m gi√°: <strong id="invDiscount"></strong></p>
                    <p style="font-size: 18px;">TH√ÄNH TI·ªÄN: <strong id="invFinal"></strong></p>
                    <p>Ph∆∞∆°ng th·ª©c: <strong id="invMethod"></strong></p>
                    <hr>
                    <p style="text-align: center; margin-top: 20px;">C·∫£m ∆°n qu√Ω kh√°ch!</p>
                    <button class="btn btn-primary" onclick="window.print()" style="margin-top: 20px;">üñ®Ô∏è In h√≥a ƒë∆°n</button>
                </div>
            </div>
        </div>

        <!-- Tab 2: Qu·∫£n l√Ω H√≥a ƒë∆°n -->
        <div id="invoices" class="tab-content">
            <h2 style="margin-bottom: 20px;">Qu·∫£n l√Ω H√≥a ƒë∆°n/Giao d·ªãch</h2>
            
            <!-- Ph·∫ßn T√¨m ki·∫øm -->
            <div class="form-section">
                <h3>T√¨m ki·∫øm H√≥a ƒë∆°n</h3>
                <div class="grid-2">
                    <div class="form-group">
                        <label>M√£ h√≥a ƒë∆°n</label>
                        <input type="text" id="searchInvoiceId" placeholder="Nh·∫≠p m√£ h√≥a ƒë∆°n">
                    </div>
                    <div class="form-group">
                        <label>T√™n kh√°ch h√†ng</label>
                        <input type="text" id="searchCustomerName" placeholder="Nh·∫≠p t√™n kh√°ch h√†ng">
                    </div>
                    <div class="form-group">
                        <label>Bi·ªÉn s·ªë xe</label>
                        <input type="text" id="searchLicensePlate" placeholder="Nh·∫≠p bi·ªÉn s·ªë xe">
                    </div>
                    <div class="form-group">
                        <label>Tr·∫°ng th√°i</label>
                        <select id="searchStatus">
                            <option value="">T·∫•t c·∫£</option>
                            <option value="paid">ƒê√£ thanh to√°n</option>
                            <option value="unpaid">Ch∆∞a thanh to√°n</option>
                            <option value="refund">ƒê√£ ho√†n ti·ªÅn</option>
                            <option value="cancelled">ƒê√£ h·ªßy</option>
                            <option value="pending">Ch·ªù ph√™ duy·ªát</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>T·ª´ ng√†y</label>
                        <input type="date" id="searchFromDate">
                    </div>
                    <div class="form-group">
                        <label>ƒê·∫øn ng√†y</label>
                        <input type="date" id="searchToDate">
                    </div>
                </div>
                <div style="margin-top: 15px;">
                    <button class="btn btn-primary" onclick="searchInvoices()">üîç T√¨m ki·∫øm</button>
                    <button class="btn btn-secondary" onclick="resetSearch()">‚Ü∫ L√†m m·ªõi</button>
                </div>
            </div>

            <!-- Ph·∫ßn Danh s√°ch -->
            <div class="form-section">
                <h3>Danh s√°ch H√≥a ƒë∆°n</h3>
                <div style="margin-bottom: 15px;">
                    <label style="font-weight: 600; margin-right: 10px;">S·∫Øp x·∫øp theo:</label>
                    <select id="sortBy" onchange="sortInvoices()" style="padding: 8px; border-radius: 5px; border: 2px solid #dee2e6;">
                        <option value="date-desc">Ng√†y (M·ªõi nh·∫•t)</option>
                        <option value="date-asc">Ng√†y (C≈© nh·∫•t)</option>
                        <option value="amount-desc">S·ªë ti·ªÅn (Cao ƒë·∫øn th·∫•p)</option>
                        <option value="amount-asc">S·ªë ti·ªÅn (Th·∫•p ƒë·∫øn cao)</option>
                    </select>
                </div>
                <table>
                    <thead>
                        <tr>
                            <th>M√£ ƒë∆°n</th>
                            <th>Ng√†y gi·ªù</th>
                            <th>Kh√°ch h√†ng</th>
                            <th>Bi·ªÉn s·ªë xe</th>
                            <th>T·ªïng ti·ªÅn</th>
                            <th>Ng∆∞·ªùi t·∫°o</th>
                            <th>Tr·∫°ng th√°i</th>
                            <th>Thao t√°c</th>
                        </tr>
                    </thead>
                    <tbody id="invoiceList">
                        <tr>
                            <td>DH001</td>
                            <td>22/11/2025 10:30</td>
                            <td>Nguy·ªÖn VƒÉn B</td>
                            <td>30A-12345</td>
                            <td>1,000,000 ƒë</td>
                            <td>Thu ng√¢n A</td>
                            <td><span class="shift-open">ƒê√£ thanh to√°n</span></td>
                            <td>
                                <button class="btn btn-primary" onclick="viewInvoiceDetail('DH001')" style="padding: 8px 15px;">Xem</button>
                            </td>
                        </tr>
                        <tr>
                            <td>DH002</td>
                            <td>22/11/2025 11:15</td>
                            <td>Tr·∫ßn Th·ªã C</td>
                            <td>29B-67890</td>
                            <td>750,000 ƒë</td>
                            <td>Thu ng√¢n B</td>
                            <td><span class="shift-open">ƒê√£ thanh to√°n</span></td>
                            <td>
                                <button class="btn btn-primary" onclick="viewInvoiceDetail('DH002')" style="padding: 8px 15px;">Xem</button>
                            </td>
                        </tr>
                        <tr>
                            <td>DH003</td>
                            <td>21/11/2025 14:20</td>
                            <td>L√™ VƒÉn D</td>
                            <td>51C-11111</td>
                            <td>500,000 ƒë</td>
                            <td>Thu ng√¢n A</td>
                            <td><span class="shift-closed">Ch∆∞a thanh to√°n</span></td>
                            <td>
                                <button class="btn btn-primary" onclick="viewInvoiceDetail('DH003')" style="padding: 8px 15px;">Xem</button>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Modal Chi ti·∫øt H√≥a ƒë∆°n -->
        <div id="invoiceDetailModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 1000; overflow-y: auto;">
            <div style="max-width: 900px; margin: 30px auto; background: white; border-radius: 15px; padding: 30px;">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px;">
                    <h2>Chi ti·∫øt H√≥a ƒë∆°n</h2>
                    <button onclick="closeInvoiceDetail()" style="background: none; border: none; font-size: 28px; cursor: pointer; color: #666;">√ó</button>
                </div>

                <div class="form-section">
                    <h3>Th√¥ng tin H√≥a ƒë∆°n</h3>
                    <div class="grid-2">
                        <div>
                            <p><strong>M√£ h√≥a ƒë∆°n:</strong> <span id="detailInvoiceId">DH001</span></p>
                            <p><strong>Ng√†y t·∫°o:</strong> <span id="detailDate">22/11/2025 10:30</span></p>
                            <p><strong>Ng∆∞·ªùi t·∫°o:</strong> <span id="detailCreator">Thu ng√¢n A</span></p>
                        </div>
                        <div>
                            <p><strong>Tr·∫°ng th√°i:</strong> <span class="shift-open" id="detailStatus">ƒê√£ thanh to√°n</span></p>
                            <p><strong>S·ªë l·∫ßn in:</strong> <span id="detailPrintCount">1</span></p>
                        </div>
                    </div>
                </div>

                <div class="form-section">
                    <h3>Th√¥ng tin Kh√°ch h√†ng</h3>
                    <p><strong>T√™n:</strong> <span id="detailCustomerName">Nguy·ªÖn VƒÉn B</span></p>
                    <p><strong>SƒêT:</strong> <span id="detailCustomerPhone">0901234567</span></p>
                    <p><strong>Bi·ªÉn s·ªë xe:</strong> <span id="detailLicensePlate">30A-12345</span></p>
                </div>

                <div class="form-section">
                    <h3>Chi ti·∫øt S·∫£n ph·∫©m/D·ªãch v·ª•</h3>
                    <table>
                        <thead>
                            <tr>
                                <th>T√™n</th>
                                <th>S·ªë l∆∞·ª£ng</th>
                                <th>ƒê∆°n gi√°</th>
                                <th>Th√†nh ti·ªÅn</th>
                            </tr>
                        </thead>
                        <tbody id="detailProductList">
                            <tr>
                                <td>R·ª≠a xe √¥ t√¥</td>
                                <td>1</td>
                                <td>100,000 ƒë</td>
                                <td>100,000 ƒë</td>
                            </tr>
                            <tr>
                                <td>ƒê√°nh b√≥ng</td>
                                <td>1</td>
                                <td>500,000 ƒë</td>
                                <td>500,000 ƒë</td>
                            </tr>
                            <tr>
                                <td>Ph·ªß ceramic</td>
                                <td>1</td>
                                <td>400,000 ƒë</td>
                                <td>400,000 ƒë</td>
                            </tr>
                        </tbody>
                    </table>
                    <div style="text-align: right; margin-top: 15px; font-size: 16px;">
                        <p><strong>T·∫°m t√≠nh:</strong> <span id="detailSubtotal">1,000,000 ƒë</span></p>
                        <p><strong>Gi·∫£m gi√°:</strong> <span id="detailDiscount">0 ƒë</span></p>
                        <p><strong>Thu·∫ø VAT (10%):</strong> <span id="detailTax">100,000 ƒë</span></p>
                        <p style="font-size: 20px; color: #667eea;"><strong>T·ªîNG C·ªòNG:</strong> <span id="detailTotal">1,100,000 ƒë</span></p>
                    </div>
                </div>

                <div class="form-section">
                    <h3>Ph∆∞∆°ng th·ª©c Thanh to√°n</h3>
                    <p id="detailPaymentMethod">Ti·ªÅn m·∫∑t: 1,100,000 ƒë</p>
                </div>

                <div class="form-section">
                    <h3>L·ªãch s·ª≠ Thao t√°c</h3>
                    <div id="detailHistory">
                        <p>‚Ä¢ 22/11/2025 10:30 - T·∫°o h√≥a ƒë∆°n b·ªüi Thu ng√¢n A</p>
                        <p>‚Ä¢ 22/11/2025 10:35 - Thanh to√°n th√†nh c√¥ng</p>
                        <p>‚Ä¢ 22/11/2025 10:36 - In h√≥a ƒë∆°n l·∫ßn 1</p>
                    </div>
                </div>

                <div style="margin-top: 25px; display: flex; gap: 10px; flex-wrap: wrap;">
                    <button class="btn btn-primary" onclick="printInvoiceAgain()">üñ®Ô∏è In l·∫°i H√≥a ƒë∆°n</button>
                    <button class="btn btn-success" onclick="processPayment()" id="btnPayNow" style="display: none;">üí∞ Thanh to√°n</button>
                    <button class="btn btn-danger" onclick="showRefundModal()">‚Ü©Ô∏è Y√™u c·∫ßu Ho√†n ti·ªÅn</button>
                    <button class="btn btn-danger" onclick="showCancelModal()">‚ùå H·ªßy H√≥a ƒë∆°n</button>
                    <button class="btn btn-secondary" onclick="closeInvoiceDetail()">ƒê√≥ng</button>
                </div>
            </div>
        </div>

        <!-- Modal Ho√†n ti·ªÅn -->
        <div id="refundModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 1001;">
            <div style="max-width: 600px; margin: 100px auto; background: white; border-radius: 15px; padding: 30px;">
                <h2 style="margin-bottom: 20px;">Y√™u c·∫ßu Ho√†n ti·ªÅn</h2>
                <div class="form-group">
                    <label>L√Ω do ho√†n ti·ªÅn</label>
                    <select id="refundReason" style="width: 100%; padding: 12px; border: 2px solid #dee2e6; border-radius: 8px;">
                        <option value="">-- Ch·ªçn l√Ω do --</option>
                        <option value="customer-change">Kh√°ch h√†ng ƒë·ªïi √Ω</option>
                        <option value="wrong-service">Nh·∫≠p sai d·ªãch v·ª•</option>
                        <option value="payment-error">Thanh to√°n nh·∫ßm</option>
                        <option value="technical-error">L·ªói k·ªπ thu·∫≠t</option>
                        <option value="other">L√Ω do kh√°c</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Ghi ch√∫ chi ti·∫øt</label>
                    <textarea id="refundNote" rows="4" style="width: 100%; padding: 12px; border: 2px solid #dee2e6; border-radius: 8px;" placeholder="Nh·∫≠p chi ti·∫øt l√Ω do ho√†n ti·ªÅn..."></textarea>
                </div>
                <div style="margin-top: 20px;">
                    <button class="btn btn-danger" onclick="submitRefundRequest()">X√°c nh·∫≠n Ho√†n ti·ªÅn</button>
                    <button class="btn btn-secondary" onclick="closeRefundModal()">H·ªßy</button>
                </div>
            </div>
        </div>

        <!-- Modal H·ªßy h√≥a ƒë∆°n -->
        <div id="cancelModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 1001;">
            <div style="max-width: 600px; margin: 100px auto; background: white; border-radius: 15px; padding: 30px;">
                <h2 style="margin-bottom: 20px;">H·ªßy H√≥a ƒë∆°n</h2>
                <div class="form-group">
                    <label>L√Ω do h·ªßy</label>
                    <select id="cancelReason" style="width: 100%; padding: 12px; border: 2px solid #dee2e6; border-radius: 8px;">
                        <option value="">-- Ch·ªçn l√Ω do --</option>
                        <option value="duplicate">T·∫°o tr√πng h√≥a ƒë∆°n</option>
                        <option value="wrong-info">Th√¥ng tin sai</option>
                        <option value="customer-cancel">Kh√°ch h√†ng h·ªßy</option>
                        <option value="technical-error">L·ªói h·ªá th·ªëng</option>
                        <option value="other">L√Ω do kh√°c</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Ghi ch√∫ chi ti·∫øt</label>
                    <textarea id="cancelNote" rows="4" style="width: 100%; padding: 12px; border: 2px solid #dee2e6; border-radius: 8px;" placeholder="Nh·∫≠p chi ti·∫øt l√Ω do h·ªßy..."></textarea>
                </div>
                <div style="margin-top: 20px;">
                    <button class="btn btn-danger" onclick="submitCancelRequest()">X√°c nh·∫≠n H·ªßy</button>
                    <button class="btn btn-secondary" onclick="closeCancelModal()">ƒê√≥ng</button>
                </div>
            </div>
        </div>

        <!-- Tab 3: M·ªü/ƒê√≥ng Ca -->
        <div id="shift" class="tab-content">
            <h2 style="margin-bottom: 20px;">Qu·∫£n l√Ω Ca l√†m vi·ªác</h2>
            
            <div class="form-section">
                <h3>Tr·∫°ng th√°i Ca hi·ªán t·∫°i</h3>
                <div style="text-align: center; padding: 20px;">
                    <span class="shift-status shift-closed" id="shiftStatus">CA ƒêANG ƒê√ìNG</span>
                    <p style="margin-top: 15px; font-size: 16px;" id="shiftInfo">Ch∆∞a c√≥ ca l√†m vi·ªác n√†o ƒë∆∞·ª£c m·ªü</p>
                </div>
            </div>

            <div class="form-section">
                <h3>M·ªü Ca l√†m vi·ªác m·ªõi</h3>
                <div class="form-group">
                    <label>T√™n thu ng√¢n</label>
                    <input type="text" id="cashierName" placeholder="Nh·∫≠p t√™n thu ng√¢n">
                </div>
                <div class="form-group">
                    <label>S·ªë ti·ªÅn ƒë·∫ßu ca (Qu·ªπ ti·ªÅn m·∫∑t ban ƒë·∫ßu)</label>
                    <input type="number" id="startingCash" placeholder="Nh·∫≠p s·ªë ti·ªÅn ƒë·∫ßu ca">
                </div>
                <button class="btn btn-success" onclick="openShift()">üîì M·ªû CA</button>
            </div>

            <div class="form-section">
                <h3>ƒê√≥ng Ca l√†m vi·ªác</h3>
                <div class="form-group">
                    <label>S·ªë ti·ªÅn cu·ªëi ca (Th·ª±c t·∫ø)</label>
                    <input type="number" id="endingCash" placeholder="Nh·∫≠p s·ªë ti·ªÅn th·ª±c t·∫ø">
                </div>
                <div class="form-group">
                    <label>Ghi ch√∫</label>
                    <input type="text" id="shiftNote" placeholder="Ghi ch√∫ v·ªÅ ca l√†m vi·ªác">
                </div>
                <button class="btn btn-danger" onclick="closeShift()">üîí ƒê√ìNG CA</button>
            </div>
        </div>

        <!-- Tab 4: B√°o c√°o Thu chi -->
        <div id="report" class="tab-content">
            <h2 style="margin-bottom: 20px;">B√°o c√°o Thu chi</h2>
            
            <div class="grid-2">
                <div class="form-group">
                    <label>T·ª´ ng√†y</label>
                    <input type="date" id="reportFrom">
                </div>
                <div class="form-group">
                    <label>ƒê·∫øn ng√†y</label>
                    <input type="date" id="reportTo">
                </div>
            </div>
            <button class="btn btn-primary" onclick="generateReport()">üìä Xem b√°o c√°o</button>

            <div style="margin-top: 30px;">
                <h3 style="margin-bottom: 20px;">T·ªïng quan Thu chi</h3>
                <div class="grid-2">
                    <div style="background: #d4edda; padding: 25px; border-radius: 10px; text-align: center;">
                        <div style="font-size: 16px; color: #155724; margin-bottom: 10px;">T·ªîNG THU</div>
                        <div style="font-size: 32px; font-weight: bold; color: #155724;">5,250,000 ƒë</div>
                    </div>
                    <div style="background: #f8d7da; padding: 25px; border-radius: 10px; text-align: center;">
                        <div style="font-size: 16px; color: #721c24; margin-bottom: 10px;">T·ªîNG CHI</div>
                        <div style="font-size: 32px; font-weight: bold; color: #721c24;">1,500,000 ƒë</div>
                    </div>
                </div>

                <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); padding: 25px; border-radius: 10px; text-align: center; margin-top: 20px; color: white;">
                    <div style="font-size: 16px; margin-bottom: 10px;">L·ª¢I NHU·∫¨N THU·∫¶N</div>
                    <div style="font-size: 36px; font-weight: bold;">3,750,000 ƒë</div>
                </div>

                <table style="margin-top: 30px;">
                    <thead>
                        <tr>
                            <th>Ng√†y</th>
                            <th>S·ªë giao d·ªãch</th>
                            <th>T·ªïng thu</th>
                            <th>T·ªïng chi</th>
                            <th>L·ª£i nhu·∫≠n</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>22/11/2025</td>
                            <td>15</td>
                            <td>2,500,000 ƒë</td>
                            <td>700,000 ƒë</td>
                            <td>1,800,000 ƒë</td>
                        </tr>
                        <tr>
                            <td>21/11/2025</td>
                            <td>12</td>
                            <td>1,850,000 ƒë</td>
                            <td>500,000 ƒë</td>
                            <td>1,350,000 ƒë</td>
                        </tr>
                        <tr>
                            <td>20/11/2025</td>
                            <td>10</td>
                            <td>900,000 ƒë</td>
                            <td>300,000 ƒë</td>
                            <td>600,000 ƒë</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <script>
        // D·ªØ li·ªáu l∆∞u trong b·ªô nh·ªõ
        let currentInvoice = null;
        let currentShift = null;
        let transactions = [];
        let totalAmount = 1000000;
        let discountAmount = 0;
        let finalAmount = 1000000;

        function switchTab(tabName) {
            const tabs = document.querySelectorAll('.tab-content');
            const buttons = document.querySelectorAll('.tab-btn');
            
            tabs.forEach(tab => tab.classList.remove('active'));
            buttons.forEach(btn => btn.classList.remove('active'));
            
            document.getElementById(tabName).classList.add('active');
            event.target.classList.add('active');
        }

        function loadInvoice() {
            const orderId = document.getElementById('orderId').value;
            if (!orderId) {
                alert('Vui l√≤ng nh·∫≠p m√£ ƒë∆°n h√†ng!');
                return;
            }
            
            document.getElementById('invoiceDetails').style.display = 'block';
            currentInvoice = {
                orderId: orderId,
                products: [
                    {name: 'S·∫£n ph·∫©m A', qty: 2, price: 500000},
                    {name: 'S·∫£n ph·∫©m B', qty: 1, price: 300000},
                    {name: 'D·ªãch v·ª• C', qty: 1, price: 200000}
                ],
                total: 1000000
            };
            
            calculateTotal();
        }

        function applyDiscount() {
            const promoCode = document.getElementById('promoCode').value;
            const discount = parseFloat(document.getElementById('discount').value) || 0;
            
            if (promoCode) {
                alert('ƒê√£ √°p d·ª•ng m√£ khuy·∫øn m√£i: ' + promoCode);
            }
            
            calculateTotal();
        }

        function calculateTotal() {
            const discount = parseFloat(document.getElementById('discount').value) || 0;
            discountAmount = totalAmount * (discount / 100);
            finalAmount = totalAmount - discountAmount;
            
            document.getElementById('totalAmount').innerHTML = 'T·ªîNG TI·ªÄN: ' + formatCurrency(totalAmount);
            document.getElementById('finalAmount').innerHTML = 'PH·∫¢I THANH TO√ÅN: ' + formatCurrency(finalAmount);
        }

        function togglePayment(type) {
            const checkbox = document.getElementById('pay' + type.charAt(0).toUpperCase() + type.slice(1));
            checkbox.checked = !checkbox.checked;
            
            const input = document.getElementById(type + 'Input');
            if (checkbox.checked) {
                input.style.display = 'block';
                if (type === 'cash') {
                    document.getElementById('cashAmount').value = finalAmount;
                }
            } else {
                input.style.display = 'none';
            }
        }

        function calculateChange() {
            const cashGiven = parseFloat(document.getElementById('cashGiven').value) || 0;
            const cashAmount = parseFloat(document.getElementById('cashAmount').value) || 0;
            
            if (cashGiven > 0 && cashAmount > 0) {
                const change = cashGiven - cashAmount;
                if (change >= 0) {
                    document.getElementById('changeDisplay').style.display = 'block';
                    document.getElementById('changeDisplay').innerHTML = 'TI·ªÄN TH·ª™A: ' + formatCurrency(change);
                } else {
                    alert('S·ªë ti·ªÅn kh√°ch ƒë∆∞a kh√¥ng ƒë·ªß!');
                }
            }
        }

        function completeTransaction() {
            if (!currentInvoice) {
                alert('Vui l√≤ng t·∫£i th√¥ng tin h√≥a ƒë∆°n tr∆∞·ªõc!');
                return;
            }
            
            const payCash = document.getElementById('payCash').checked;
            const payCard = document.getElementById('payCard').checked;
            const payTransfer = document.getElementById('payTransfer').checked;
            
            if (!payCash && !payCard && !payTransfer) {
                alert('Vui l√≤ng ch·ªçn ph∆∞∆°ng th·ª©c thanh to√°n!');
                return;
            }
            
            let totalPaid = 0;
            let paymentMethods = [];
            
            if (payCash) {
                const cashAmount = parseFloat(document.getElementById('cashAmount').value) || 0;
                totalPaid += cashAmount;
                paymentMethods.push('Ti·ªÅn m·∫∑t: ' + formatCurrency(cashAmount));
            }
            
            if (payCard) {
                const cardAmount = parseFloat(document.getElementById('cardAmount').value) || 0;
                totalPaid += cardAmount;
                paymentMethods.push('Th·∫ª: ' + formatCurrency(cardAmount));
            }
            
            if (payTransfer) {
                const transferAmount = parseFloat(document.getElementById('transferAmount').value) || 0;
                totalPaid += transferAmount;
                paymentMethods.push('Chuy·ªÉn kho·∫£n: ' + formatCurrency(transferAmount));
            }
            
            if (Math.abs(totalPaid - finalAmount) > 1) {
                alert('T·ªïng s·ªë ti·ªÅn thanh to√°n kh√¥ng kh·ªõp v·ªõi s·ªë ti·ªÅn ph·∫£i tr·∫£!\nPh·∫£i tr·∫£: ' + formatCurrency(finalAmount) + '\nƒê√£ nh·∫≠n: ' + formatCurrency(totalPaid));
                return;
            }
            
            // Hi·ªÉn th·ªã h√≥a ƒë∆°n
            const now = new Date();
            document.getElementById('invOrderId').textContent = currentInvoice.orderId;
            document.getElementById('invDate').textContent = now.toLocaleString('vi-VN');
            
            let productsHTML = '';
            currentInvoice.products.forEach(p => {
                productsHTML += `<p>${p.name} x${p.qty}: ${formatCurrency(p.price)}</p>`;
            });
            document.getElementById('invProducts').innerHTML = productsHTML;
            
            document.getElementById('invTotal').textContent = formatCurrency(totalAmount);
            document.getElementById('invDiscount').textContent = formatCurrency(discountAmount);
            document.getElementById('invFinal').textContent = formatCurrency(finalAmount);
            document.getElementById('invMethod').textContent = paymentMethods.join(', ');
            
            document.getElementById('invoicePreview').style.display = 'block';
            
            // L∆∞u giao d·ªãch
            transactions.push({
                orderId: currentInvoice.orderId,
                date: now,
                amount: finalAmount,
                paymentMethods: paymentMethods
            });
            
            alert('‚úì Giao d·ªãch ho√†n t·∫•t th√†nh c√¥ng!\n\nC·∫£m ∆°n qu√Ω kh√°ch v√† h·∫πn g·∫∑p l·∫°i!');
        }

        function resetTransaction() {
            if (confirm('B·∫°n c√≥ ch·∫Øc mu·ªën l√†m m·ªõi giao d·ªãch?')) {
                document.getElementById('orderId').value = '';
                document.getElementById('customerId').value = '';
                document.getElementById('memberPhone').value = '';
                document.getElementById('promoCode').value = '';
                document.getElementById('discount').value = '0';
                document.getElementById('invoiceDetails').style.display = 'none';
                document.getElementById('invoicePreview').style.display = 'none';
                
                document.getElementById('payCash').checked = false;
                document.getElementById('payCard').checked = false;
                document.getElementById('payTransfer').checked = false;
                
                document.getElementById('cashInput').style.display = 'none';
                document.getElementById('cardInput').style.display = 'none';
                document.getElementById('transferInput').style.display = 'none';
                
                currentInvoice = null;
                totalAmount = 1000000;
                discountAmount = 0;
                finalAmount = 1000000;
                
                calculateTotal();
            }
        }

        function openShift() {
            const cashierName = document.getElementById('cashierName').value;
            const startingCash = document.getElementById('startingCash').value;
            
            if (!cashierName || !startingCash) {
                alert('Vui l√≤ng nh·∫≠p ƒë·∫ßy ƒë·ªß th√¥ng tin!');
                return;
            }
            
            currentShift = {
                cashier: cashierName,
                startingCash: parseFloat(startingCash),
                startTime: new Date(),
                transactions: []
            };
            
            document.getElementById('shiftStatus').textContent = 'CA ƒêANG M·ªû';
            document.getElementById('shiftStatus').className = 'shift-status shift-open';
            document.getElementById('shiftInfo').textContent = `Thu ng√¢n: ${cashierName} | B·∫Øt ƒë·∫ßu: ${currentShift.startTime.toLocaleString('vi-VN')}`;
            
            alert('‚úì ƒê√£ m·ªü ca l√†m vi·ªác th√†nh c√¥ng!');
        }

        function closeShift() {
            if (!currentShift) {
                alert('Ch∆∞a c√≥ ca l√†m vi·ªác n√†o ƒë∆∞·ª£c m·ªü!');
                return;
            }
            
            const endingCash = document.getElementById('endingCash').value;
            const note = document.getElementById('shiftNote').value;
            
            if (!endingCash) {
                alert('Vui l√≤ng nh·∫≠p s·ªë ti·ªÅn cu·ªëi ca!');
                return;
            }
            
            currentShift.endingCash = parseFloat(endingCash);
            currentShift.endTime = new Date();
            currentShift.note = note;
            
            const difference = currentShift.endingCash - currentShift.startingCash;
            
            alert(`‚úì ƒê√£ ƒë√≥ng ca l√†m vi·ªác!\n\nThu ng√¢n: ${currentShift.cashier}\nTh·ªùi gian: ${currentShift.startTime.toLocaleString('vi-VN')} - ${currentShift.endTime.toLocaleString('vi-VN')}\nS·ªë ti·ªÅn ƒë·∫ßu ca: ${formatCurrency(currentShift.startingCash)}\nS·ªë ti·ªÅn cu·ªëi ca: ${formatCurrency(currentShift.endingCash)}\nCh√™nh l·ªách: ${formatCurrency(difference)}`);
            
            document.getElementById('shiftStatus').textContent = 'CA ƒêANG ƒê√ìNG';
            document.getElementById('shiftStatus').className = 'shift-status shift-closed';
            document.getElementById('shiftInfo').textContent = 'Ch∆∞a c√≥ ca l√†m vi·ªác n√†o ƒë∆∞·ª£c m·ªü';
            
            currentShift = null;
            
            document.getElementById('cashierName').value = '';
            document.getElementById('startingCash').value = '';
            document.getElementById('endingCash').value = '';
            document.getElementById('shiftNote').value = '';
        }

        function generateReport() {
            const from = document.getElementById('reportFrom').value;
            const to = document.getElementById('reportTo').value;
            
            if (!from || !to) {
                alert('Vui l√≤ng ch·ªçn kho·∫£ng th·ªùi gian!');
                return;
            }
            
            alert('ƒê√£ t·∫°o b√°o c√°o t·ª´ ' + from + ' ƒë·∫øn ' + to);
        }

        function formatCurrency(amount) {
            return new Intl.NumberFormat('vi-VN', {
                style: 'currency',
                currency: 'VND'
            }).format(amount);
        }

        // Kh·ªüi t·∫°o ng√†y m·∫∑c ƒë·ªãnh cho b√°o c√°o
        window.onload = function() {
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('reportFrom').value = today;
            document.getElementById('reportTo').value = today;
        };
    </script>
</body>
</html>